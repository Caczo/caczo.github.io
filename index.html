<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система управления остатками и маржи</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>Система управления остатками и маржи</h1>
            <div class="last-update">
                Последнее обновление: <span id="last-update-time">---</span>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="margin-calculator">Калькулятор маржи</button>
            <button class="tab-btn" data-tab="inventory-database">База остатков</button>
            <button class="tab-btn" data-tab="sales-log">Продажи</button>
            <button class="tab-btn" data-tab="column-settings">Настройки колонок</button>
            <button class="tab-btn" data-tab="settings">Настройки</button>
        </nav>

        <!-- Tab 1: Margin Calculator -->
        <section class="tab-content active" id="margin-calculator">
            <!-- Exchange Rates Panel -->
            <div class="card rates-panel">
                <div class="card__header">
                    <h3>Курсы валют</h3>
                    <span class="rates-source" id="rates-source-display">Источник: ЦБ РФ на 07.10.2025</span>
                </div>
                <div class="card__body">
                    <div class="rates-grid">
                        <div class="rate-item">
                            <label class="form-label">1 CNY = USD</label>
                            <span class="rate-display" id="cny-usd-display">0.1393</span>
                        </div>
                        <div class="rate-item">
                            <label class="form-label">1 CNY = RUB</label>
                            <span class="rate-display" id="cny-rub-display">11.5581</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Panel -->
            <div class="card stats-panel">
                <div class="card__body">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Всего товаров:</span>
                            <span class="stat-value" id="total-products-stat">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Средняя маржа:</span>
                            <span class="stat-value" id="average-margin-stat">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Общие остатки:</span>
                            <span class="stat-value" id="total-inventory-stat">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Товаров с низкими остатками:</span>
                            <span class="stat-value status--warning" id="low-stock-count">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dynamic Margin Calculator Table -->
            <div class="table-container">
                <table class="data-table" id="margin-calculator-table">
                    <thead id="margin-table-header">
                        <!-- Dynamically generated -->
                    </thead>
                    <tbody id="margin-table-body">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Summary Panel -->
            <div class="card summary-panel">
                <div class="card__body">
                    <div class="summary-grid">
                        <div class="summary-item">
                            <strong>Итого маржи (юани): <span id="total-margin-cny">0</span></strong>
                        </div>
                        <div class="summary-item">
                            <strong>Итого маржи (доллары): <span id="total-margin-usd">0</span></strong>
                        </div>
                        <div class="summary-item">
                            <strong>Итого маржи (рубли): <span id="total-margin-rub">0</span></strong>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab 2: Inventory Database -->
        <section class="tab-content" id="inventory-database">
            <div class="section-header">
                <h2>База остатков</h2>
                <div class="controls">
                    <button class="btn btn--primary" id="add-product-btn">Добавить товар</button>
                    <button class="btn btn--outline" id="export-inventory-btn">Экспорт данных</button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table" id="inventory-table">
                    <thead id="inventory-table-header">
                        <!-- Dynamically generated -->
                    </thead>
                    <tbody id="inventory-table-body">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Tab 3: Sales Log -->
        <section class="tab-content" id="sales-log">
            <div class="section-header">
                <h2>Продажи</h2>
                <button class="btn btn--primary" id="add-sale-btn">Добавить продажу</button>
            </div>

            <!-- Sales Entry Form -->
            <div class="card sales-form-card hidden" id="sales-form-card">
                <div class="card__header">
                    <h3>Новая продажа</h3>
                    <button class="btn btn--outline btn--sm" id="cancel-sale-btn">Отмена</button>
                </div>
                <div class="card__body">
                    <form id="sales-form" class="sales-form">
                        <div class="form-group">
                            <label class="form-label">Товар</label>
                            <select class="form-control" id="sale-product-select" required>
                                <option value="">Выберите товар</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Дата продажи</label>
                                <input type="date" class="form-control" id="sale-date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Количество</label>
                                <input type="number" min="1" class="form-control" id="sale-quantity" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Цена за единицу (CNY)</label>
                                <input type="number" step="0.01" class="form-control" id="sale-unit-price" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Итого (CNY)</label>
                                <input type="number" step="0.01" class="form-control" id="sale-total" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Клиент/Примечания</label>
                            <input type="text" class="form-control" id="sale-customer">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn--primary">Записать продажу</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Sales Summary -->
            <div class="card stats-panel">
                <div class="card__body">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Всего продаж:</span>
                            <span class="stat-value" id="total-sales-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Сумма продаж (CNY):</span>
                            <span class="stat-value" id="total-sales-amount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Продаж сегодня:</span>
                            <span class="stat-value" id="today-sales-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Сумма за сегодня:</span>
                            <span class="stat-value" id="today-sales-amount">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dynamic Sales History Table -->
            <div class="table-container">
                <table class="data-table" id="sales-table">
                    <thead id="sales-table-header">
                        <!-- Dynamically generated -->
                    </thead>
                    <tbody id="sales-table-body">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Tab 4: Column Settings -->
        <section class="tab-content" id="column-settings">
            <div class="section-header">
                <h2>Настройки колонок</h2>
                <div class="controls">
                    <button class="btn btn--outline" id="export-column-config-btn">Экспорт конфигурации</button>
                    <button class="btn btn--outline" id="import-column-config-btn">Импорт конфигурации</button>
                    <input type="file" id="import-column-file" accept=".json" style="display: none;">
                </div>
            </div>

            <!-- Column Settings Sub-tabs -->
            <nav class="sub-tab-nav">
                <button class="sub-tab-btn active" data-subtab="margin-columns">Маржа</button>
                <button class="sub-tab-btn" data-subtab="inventory-columns">Остатки</button>
                <button class="sub-tab-btn" data-subtab="sales-columns">Продажи</button>
            </nav>

            <!-- Column Templates Panel -->
            <div class="card templates-panel">
                <div class="card__header">
                    <h3>Шаблоны колонок</h3>
                </div>
                <div class="card__body">
                    <div class="templates-grid" id="column-templates">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Column Editor Panels -->
            <div class="sub-tab-content active" id="margin-columns">
                <div class="column-editor">
                    <div class="column-controls">
                        <button class="btn btn--primary" id="add-margin-column-btn">Добавить колонку</button>
                        <button class="btn btn--secondary" id="reset-margin-columns-btn">Сбросить к умолчанию</button>
                    </div>
                    <div class="columns-list" id="margin-columns-list">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div class="sub-tab-content" id="inventory-columns">
                <div class="column-editor">
                    <div class="column-controls">
                        <button class="btn btn--primary" id="add-inventory-column-btn">Добавить колонку</button>
                        <button class="btn btn--secondary" id="reset-inventory-columns-btn">Сбросить к умолчанию</button>
                    </div>
                    <div class="columns-list" id="inventory-columns-list">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div class="sub-tab-content" id="sales-columns">
                <div class="column-editor">
                    <div class="column-controls">
                        <button class="btn btn--primary" id="add-sales-column-btn">Добавить колонку</button>
                        <button class="btn btn--secondary" id="reset-sales-columns-btn">Сбросить к умолчанию</button>
                    </div>
                    <div class="columns-list" id="sales-columns-list">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Column Configuration Modal -->
            <div class="modal hidden" id="column-config-modal">
                <div class="modal-backdrop" id="modal-backdrop"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modal-title">Настройка колонки</h3>
                        <button class="modal-close-btn" id="modal-close-btn">✕</button>
                    </div>
                    <div class="modal-body">
                        <form id="column-config-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Название колонки</label>
                                    <input type="text" class="form-control" id="column-name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Тип колонки</label>
                                    <select class="form-control" id="column-type" required>
                                        <option value="text">Текст</option>
                                        <option value="number">Число</option>
                                        <option value="currency">Валюта</option>
                                        <option value="percentage">Процент</option>
                                        <option value="date">Дата</option>
                                        <option value="formula">Формула</option>
                                        <option value="dropdown">Выпадающий список</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Ширина (px)</label>
                                    <input type="number" class="form-control" id="column-width" min="50" max="500" value="150">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Символ валюты</label>
                                    <input type="text" class="form-control" id="column-symbol" placeholder="¥, $, ₽" maxlength="3">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="column-required"> Обязательное поле
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="column-visible" checked> Видимая колонка
                                </label>
                            </div>
                            <div class="form-group" id="formula-group">
                                <label class="form-label">Формула</label>
                                <textarea class="form-control" id="column-formula" rows="3" placeholder="Например: [цена] - [себестоимость]"></textarea>
                                <small class="form-hint">Используйте [название_колонки] для ссылок на другие колонки</small>
                            </div>
                            <div class="form-group" id="dropdown-group">
                                <label class="form-label">Варианты (каждый с новой строки)</label>
                                <textarea class="form-control" id="column-options" rows="3" placeholder="Вариант 1&#10;Вариант 2&#10;Вариант 3"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Значение по умолчанию</label>
                                <input type="text" class="form-control" id="column-default">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn--outline" id="modal-cancel-btn">Отмена</button>
                        <button type="submit" form="column-config-form" class="btn btn--primary" id="modal-save-btn">Сохранить</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab 5: Settings -->
        <section class="tab-content" id="settings">
            <div class="section-header">
                <h2>Настройки</h2>
            </div>

            <!-- Exchange Rates Settings -->
            <div class="card">
                <div class="card__header">
                    <h3>Управление курсами валют</h3>
                </div>
                <div class="card__body">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">1 CNY = USD</label>
                            <input type="number" step="0.0001" class="form-control" id="settings-cny-usd" value="0.1393">
                        </div>
                        <div class="form-group">
                            <label class="form-label">1 CNY = RUB</label>
                            <input type="number" step="0.0001" class="form-control" id="settings-cny-rub" value="11.5581">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Источник курсов</label>
                            <input type="text" class="form-control" id="settings-rate-source" value="ЦБ РФ">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Дата обновления</label>
                            <input type="text" class="form-control" id="settings-rate-date" value="07.10.2025">
                        </div>
                    </div>
                    <button class="btn btn--primary" id="update-rates-btn">Обновить курсы</button>
                </div>
            </div>

            <!-- System Settings -->
            <div class="card">
                <div class="card__header">
                    <h3>Настройки системы</h3>
                </div>
                <div class="card__body">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Порог низких остатков</label>
                            <input type="number" min="0" class="form-control" id="settings-low-stock-threshold" value="10">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Интервал автосохранения (сек)</label>
                            <input type="number" min="10" class="form-control" id="settings-autosave-interval" value="30">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Знаков после запятой</label>
                            <select class="form-control" id="settings-decimals">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2" selected>2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn--primary" id="save-settings-btn">Сохранить настройки</button>
                </div>
            </div>

            <!-- Data Management -->
            <div class="card">
                <div class="card__header">
                    <h3>Управление данными</h3>
                </div>
                <div class="card__body">
                    <div class="data-actions">
                        <button class="btn btn--outline" id="export-all-btn">Экспорт всех данных</button>
                        <button class="btn btn--outline" id="import-data-btn">Импорт данных</button>
                        <input type="file" id="import-file-input" accept=".json,.csv" style="display: none;">
                        <button class="btn btn--secondary" id="reset-data-btn">Сбросить к примеру</button>
                    </div>
                    <div class="data-info">
                        <p>Всего товаров: <span id="data-products-count">0</span></p>
                        <p>Всего продаж: <span id="data-sales-count">0</span></p>
                        <p>Размер данных: <span id="data-size">0 KB</span></p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script src="app.js"></script>
</body>
</html>